<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nephilim Wars - Biblical RPG</title>
  <meta name="description" content="A digital tabletop companion for the Nephilim Wars Biblical RPG">
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>‚öîÔ∏è</text></svg>">
  <link rel="manifest" href="manifest.json">
  <script src="https://cdn.tailwindcss.com"></script>
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  
  <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
  
  <style>
    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 8px; height: 8px; }
    ::-webkit-scrollbar-track { background: #1f2937; }
    ::-webkit-scrollbar-thumb { background: #d97706; border-radius: 4px; }
    ::-webkit-scrollbar-thumb:hover { background: #b45309; }
    
    /* Smooth transitions */
    * { transition: background-color 0.2s, border-color 0.2s, color 0.2s, transform 0.2s, box-shadow 0.2s; }
    
    /* Loading state */
    .loading-screen {
      position: fixed;
      inset: 0;
      background: #111827;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
      gap: 1rem;
      z-index: 9999;
    }
    .loading-screen.hidden { display: none; }
    .loader {
      width: 48px;
      height: 48px;
      border: 4px solid #d97706;
      border-top-color: transparent;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin { to { transform: rotate(360deg); } }

    /* ANIMATIONS */
    @keyframes bounce-once {
      0%, 100% { transform: translateY(0); }
      50% { transform: translateY(-10px); }
    }
    .animate-bounce-once {
        animation: bounce-once 0.3s ease-out;
    }

    @keyframes tumble {
        0% { transform: rotate(0deg) scale(1); }
        25% { transform: rotate(90deg) scale(0.9); }
        50% { transform: rotate(180deg) scale(1.1); }
        75% { transform: rotate(270deg) scale(0.9); }
        100% { transform: rotate(360deg) scale(1); }
    }
    .animate-tumble {
        animation: tumble 0.6s linear infinite;
    }

    @keyframes bounce-y {
      0%, 100% { transform: translateY(-5%); }
      50% { transform: translateY(0); }
    }
    .animate-bounce-y {
      animation: bounce-y 1.5s infinite;
    }
  </style>
</head>
<body>
  <div id="loading" class="loading-screen">
    <div class="loader"></div>
    <p class="text-amber-400 text-lg">Loading Nephilim Wars...</p>
  </div>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useEffect, useRef } = React;

// ============================================
    // GLOBAL DATA (Bestiary) - EXPANDED LORE
    // ============================================
    const BESTIARY_DATA = {
      giants: {
        title: "Giants ‚Äî The Forbidden Offspring",
        intro: "Born of Watcher and human unions, giants terrorize the earth.",
        creatures: [
          { 
            name: "Ohya, Son of Semyaza", 
            image: "images/Ohya.png", 
            hd: 14, hp: 140, def: 18, 
            attack: "Sword of Wrath +14 (4d10+8 fire)", 
            special: "Legendary, Prophetic Dreams", 
            desc: "The wrathful first-born of Semyaza.", 
            lore: "In the Book of Giants, Ohya is plagued by nightmares. He dreamt of a great tablet submerged in water, where names were washed away until only three remained (symbolizing Noah's sons). He is the more violent brother, constantly arguing against the judgment that Mahway brings news of.",
            legendary: true 
          },
          { 
            name: "Hahya, Brother of Ohya", 
            image: "images/Hahya.png", 
            hd: 12, hp: 110, def: 16, 
            attack: "Greataxe +11 (3d12+6)", 
            special: "Legendary, Dream Visions", 
            desc: "The contemplative brother.", 
            lore: "Hahya had a distinct dream of a garden where gardeners (angels) watered 200 trees and great shoots, only to burn the garden and leave one tree standing. He represents the giants' realization that their 'fathers' (the Watchers) cannot save them from the coming Flood.",
            legendary: true 
          },
          { 
            name: "Mahway, the Winged", 
            image: "images/Mahway.png", 
            hd: 10, hp: 95, def: 19, 
            attack: "Diving Attack +12 (4d8+5)", 
            special: "Legendary, True Flight", 
            desc: "Son of Barakel, the messenger.", 
            lore: "Mahway is unique among giants for his ability to fly. In the texts, he is sent by the other giants to fly to the 'ends of the earth' to find Enoch the Scribe and petition for mercy. He returns with the Tablet of Judgment, sealing the giants' fate.",
            legendary: true 
          },
          { 
            name: "Gilgamesh", 
            image: "images/Gilgamesh.png", 
            hd: 12, hp: 120, def: 17, 
            attack: "Hero's Blade +12 (3d10+7)", 
            special: "Legendary, Wrestler Supreme", 
            desc: "The legendary hero-king.", 
            lore: "Mentioned explicitly in the Dead Sea Scrolls fragments of the Book of Giants. Unlike the Mesopotamian hero, here he is one of the Nephilim offspring, a mighty warrior confused by the nightmares plaguing his brethren.",
            legendary: true 
          },
          { 
            name: "Greater Giant (1st Gen)", 
            image: "images/GreaterGiant.png", 
            hd: 16, hp: 160, def: 16, 
            attack: "Massive Club +12 (4d12+8)", 
            special: "Colossal, Terrifying Presence", 
            desc: "Direct offspring of Watchers.",
            lore: "The first generation stood as tall as cedars (Amos 2:9). Their hunger was insatiable; when they consumed all the produce of men, they began to sin against birds, beasts, reptiles, and fish, and to devour one another's flesh and drink the blood."
          },
          { 
            name: "Nephilim Warlord", 
            image: "images/NephilimWarlord.jpg", 
            hd: 10, hp: 100, def: 17, 
            attack: "Bronze Sword +10 (3d10+6)", 
            special: "Giant-Sized, Watcher's Blood", 
            desc: "The 'mighty men of old.'", 
            lore: "These are the Gibborim, the mighty men of renown. While smaller than their first-generation sires, they rule city-states with iron fists and possess superior strength to any mortal man." 
          },
          { 
            name: "Nephilim Sorcerer", 
            image: "images/NephilimSorceror.png", 
            hd: 8, hp: 70, def: 14, 
            attack: "Watcher's Fire +10 (3d8 fire)", 
            special: "Forbidden Sorcery, Spirit Sight", 
            desc: "Taught the dark arts by their fathers.", 
            lore: "Semyaza taught enchantments and root-cutting. These sorcerers use that forbidden knowledge to bind spirits and corrupt the land." 
          },
          { 
            name: "Elioud Hunter", 
            image: "images/NephilimHunter.jpg", 
            hd: 6, hp: 55, def: 15, 
            attack: "Barbed Spear +8 (2d8+4)", 
            special: "Large, Darkvision, Ambush", 
            desc: "Twisted with cruelty.", 
            lore: "The third generation (Elioud) were smaller but more vicious, serving as the scouts and hunters for the great giant kings." 
          },
          { 
            name: "Elioud Deceiver", 
            image: "images/ElioudDeceiver.jpg", 
            hd: 5, hp: 45, def: 13, 
            attack: "Hidden Blade +7 (2d6+3)", 
            special: "Shapeshifting, Silver Tongue", 
            desc: "Can compress their forms.", 
            lore: "Some Elioud inherited the shape-shifting deception of the Watchers, able to pass as large humans to infiltrate settlements." 
          },
          { 
            name: "Giant Thrall", 
            image: "images/Thrall.png", 
            hd: 4, hp: 35, def: 12, 
            attack: "Crude Club +5 (2d8+3)", 
            special: "Large, Enslaved", 
            desc: "Lesser giants.", 
            lore: "Runts of the litter, enslaved by their stronger brothers to haul stones for the great cyclopean cities." 
          }
        ]
      },
      watchers: {
        title: "The Watchers",
        intro: "The 200 angels who abandoned heaven.",
        creatures: [
          { 
            name: "Azazel (Bound)", 
            image: "images/Azazel.jpg", 
            hd: 20, hp: 200, def: 22, 
            attack: "Burning Blade +16 (5d10+10)", 
            special: "Bound in Dudael, Weapon Mastery", 
            desc: "Bound beneath jagged rocks.", 
            lore: "The chief corrupter who taught men to make swords, knives, shields, and breastplates. By divine command, Raphael bound him hand and foot and cast him into the darkness of Dudael, piling rough and jagged rocks upon him.",
            legendary: true, bound: true 
          },
          { 
            name: "Semyaza", 
            image: "images/Semyaza.png", 
            hd: 18, hp: 180, def: 20, 
            attack: "Arcane Bolt +15 (4d10+8)", 
            special: "Master of Oaths, Root-Cutting", 
            desc: "Leader of the rebellion.", 
            lore: "The leader of the 200. He feared to descend alone, so he made all 200 swear an oath (anathema) on Mount Hermon to fulfill their deed together. He taught enchantments and the properties of roots.",
            legendary: true 
          }
        ]
      },
      corrupted: {
        title: "Corrupted Humanity",
        intro: "Those who serve the giants.",
        creatures: [
          { 
            name: "Baal-Priest", 
            image: null, 
            hd: 6, hp: 50, def: 13, 
            attack: "Sacrificial Knife +6", 
            special: "Dark Sorcery", 
            desc: "Priests of the Nephilim god-kings.", 
            lore: "Humans who have abandoned the Creator to worship the Nephilim as gods, performing blood sacrifices to fuel their dark miracles." 
          },
          { 
            name: "Lamech the Avenger", 
            image: null, 
            hd: 9, hp: 85, def: 17, 
            attack: "Tubal-Cain's Blade +11", 
            special: "Legendary, Vengeance", 
            desc: "The infamous Cainite.", 
            lore: "Seventh from Adam in the line of Cain. He boasted to his wives Adah and Zillah that he had slain a man for wounding him, claiming a vengeance seventy-seven fold.", 
            legendary: true 
          }
        ]
      },
      spirits: {
        title: "Demon Spirits",
        intro: "Spirits of dead giants.",
        creatures: [
          { 
            name: "Lilith", 
            image: "images/Lilith.png", 
            hd: 15, hp: 120, def: 19, 
            attack: "Midnight Talons +12", 
            special: "Flight, Night Terror", 
            desc: "Ancient demon queen.", 
            lore: "Often associated with the night wind and screech owls. In this era, she is the mother of monsters, haunting the desolate places.", 
            legendary: true 
          },
          { 
            name: "Giant-Spirit", 
            image: null, 
            hd: 8, hp: 65, def: 15, 
            attack: "Spectral Slam +8", 
            special: "Incorporeal, Possession", 
            desc: "Wandering spirit.", 
            lore: "When a giant's physical body is killed, their immortal soul (half-angelic) cannot die nor return to heaven. They become the 'evil spirits' that wander the earth, oppressing, corrupting, and possessing humanity." 
          }
        ]
      },
      beasts: {
        title: "Corrupted Beasts",
        intro: "Animals twisted by corruption.",
        creatures: [
          { 
            name: "Behemoth", 
            image: "images/Behemoth.png", 
            hd: 18, hp: 180, def: 18, 
            attack: "Tail Sweep +14", 
            special: "Colossal Beast", 
            desc: "The greatest land beast.", 
            lore: "The primeval land-monster created on the sixth day. His tail moves like a cedar; the sinews of his stones are wrapped together. He is the masterpiece of God's physical creation, now roaming the wilderness.", 
            legendary: true 
          }
        ]
      }
    };

    // Helper to find image by name
    const findMonsterImage = (name) => {
      for (const cat of Object.values(BESTIARY_DATA)) {
        const found = cat.creatures.find(c => c.name.toLowerCase() === name.toLowerCase());
        if (found && found.image) return found.image;
      }
      return null;
    };
    // Icon components using Lucide
    const Icon = ({ name, className = "w-5 h-5" }) => {
      const ref = useRef(null);
      useEffect(() => {
        if (ref.current) {
          ref.current.innerHTML = '';
          const icon = lucide.icons[name];
          if (icon) {
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('class', className);
            svg.setAttribute('viewBox', '0 0 24 24');
            svg.setAttribute('fill', 'none');
            svg.setAttribute('stroke', 'currentColor');
            svg.setAttribute('stroke-width', '2');
            svg.setAttribute('stroke-linecap', 'round');
            svg.setAttribute('stroke-linejoin', 'round');
            svg.innerHTML = icon[2];
            ref.current.appendChild(svg);
          }
        }
      }, [name, className]);
      return <span ref={ref} className="inline-flex" />;
    };

    // ============================================
    // MAIN APP
    // ============================================
    const NephilimWarsApp = () => {
      const [activeTab, setActiveTab] = useState('home');
      const [characters, setCharacters] = useState([]);
      const [campaign, setCampaign] = useState({ name: '', era: '', notes: '', sessions: [] });
      const [combat, setCombat] = useState({ active: false, combatants: [] });
      const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
      const [darkMode, setDarkMode] = useState(true);

      // Load from localStorage on mount
      useEffect(() => {
        try {
          const savedChars = localStorage.getItem('nephilim_characters');
          const savedCampaign = localStorage.getItem('nephilim_campaign');
          const savedCombat = localStorage.getItem('nephilim_combat');
          const savedDarkMode = localStorage.getItem('nephilim_darkMode');
          
          if (savedChars) setCharacters(JSON.parse(savedChars));
          if (savedCampaign) setCampaign(JSON.parse(savedCampaign));
          if (savedCombat) setCombat(JSON.parse(savedCombat));
          if (savedDarkMode !== null) setDarkMode(JSON.parse(savedDarkMode));
        } catch (e) {
          console.log('Could not load saved data:', e);
        }
        
        // Hide loading screen
        document.getElementById('loading').classList.add('hidden');
      }, []);

      // Save to localStorage on changes
      useEffect(() => {
        try {
          localStorage.setItem('nephilim_characters', JSON.stringify(characters));
          localStorage.setItem('nephilim_campaign', JSON.stringify(campaign));
          localStorage.setItem('nephilim_combat', JSON.stringify(combat));
          localStorage.setItem('nephilim_darkMode', JSON.stringify(darkMode));
        } catch (e) {
          console.log('Could not save data:', e);
        }
      }, [characters, campaign, combat, darkMode]);

      const theme = darkMode ? {
        bg: 'bg-gray-900',
        bgSecondary: 'bg-gray-800',
        bgTertiary: 'bg-gray-700',
        text: 'text-gray-100',
        textSecondary: 'text-gray-300',
        textMuted: 'text-gray-400',
        border: 'border-gray-700',
        accent: 'bg-amber-600',
        accentHover: 'hover:bg-amber-700',
        accentText: 'text-amber-400',
        card: 'bg-gray-800 border border-gray-700',
        input: 'bg-gray-700 border-gray-600 text-gray-100',
        glow: 'shadow-amber-500/50'
      } : {
        bg: 'bg-amber-50',
        bgSecondary: 'bg-white',
        bgTertiary: 'bg-amber-100',
        text: 'text-gray-900',
        textSecondary: 'text-gray-700',
        textMuted: 'text-gray-600',
        border: 'border-amber-300',
        accent: 'bg-amber-700',
        accentHover: 'hover:bg-amber-800',
        accentText: 'text-amber-700',
        card: 'bg-white border border-amber-200',
        input: 'bg-white border-amber-300 text-gray-900',
        glow: 'shadow-amber-300/50'
      };

      const NavButton = ({ icon, label, tab }) => (
        <button
          onClick={() => setActiveTab(tab)}
          className={`flex items-center gap-2 px-3 py-2 rounded-lg transition-all text-sm ${
            activeTab === tab 
              ? 'bg-amber-700 text-white shadow-lg' 
              : 'hover:bg-gray-800'
          }`}
        >
          <Icon name={icon} className="w-4 h-4" />
          <span>{label}</span>
        </button>
      );

      const MobileNavButton = ({ icon, label, tab }) => (
        <button
          onClick={() => {
            setActiveTab(tab);
            setMobileMenuOpen(false);
          }}
          className={`flex items-center gap-3 w-full px-4 py-3 rounded-lg transition-all ${
            activeTab === tab 
              ? 'bg-amber-700 text-white' 
              : 'hover:bg-gray-800'
          }`}
        >
          <Icon name={icon} className="w-5 h-5" />
          <span>{label}</span>
        </button>
      );

      return (
        <div className={`min-h-screen ${theme.bg} ${theme.text}`}>
          {/* Navigation */}
          <nav className={`${darkMode ? 'bg-gray-900 border-b border-gray-800' : 'bg-amber-900'} text-amber-50 shadow-2xl sticky top-0 z-50`}>
            <div className="max-w-7xl mx-auto px-4">
              <div className="flex justify-between items-center h-16">
                <div className="flex items-center gap-3">
                  <Icon name="sword" className="w-8 h-8 text-amber-400" />
                  <div>
                    <h1 className="text-xl font-bold">Nephilim Wars</h1>
                    <p className="text-xs text-amber-300 hidden sm:block">Biblical RPG</p>
                  </div>
                </div>
                
                <div className="hidden md:flex gap-1 items-center">
                  <NavButton icon="book-open" label="Home" tab="home" />
                  <NavButton icon="users" label="Characters" tab="characters" />
                  <NavButton icon="sword" label="Combat" tab="combat" />
                  <NavButton icon="dices" label="Dice" tab="dice" />
                  <NavButton icon="scroll" label="Reference" tab="reference" />
                  <NavButton icon="book-marked" label="It Is Written" tab="lore" />
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className="ml-2 p-2 rounded-lg hover:bg-gray-800 transition-colors text-2xl"
                  >
                    {darkMode ? '‚òÄÔ∏è' : 'üåô'}
                  </button>
                </div>

                <button 
                  onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
                  className="md:hidden p-2 rounded-lg hover:bg-gray-800"
                >
                  <Icon name={mobileMenuOpen ? "x" : "menu"} className="w-6 h-6" />
                </button>
              </div>

              {mobileMenuOpen && (
                <div className="md:hidden pb-4 space-y-1">
                  <MobileNavButton icon="book-open" label="Home" tab="home" />
                  <MobileNavButton icon="users" label="Characters" tab="characters" />
                  <MobileNavButton icon="sword" label="Combat" tab="combat" />
                  <MobileNavButton icon="dices" label="Dice" tab="dice" />
                  <MobileNavButton icon="scroll" label="Reference" tab="reference" />
                  <MobileNavButton icon="book-marked" label="It Is Written" tab="lore" />
                  <button
                    onClick={() => setDarkMode(!darkMode)}
                    className="flex items-center gap-3 w-full px-4 py-3 rounded-lg hover:bg-gray-800"
                  >
                    <span className="text-xl">{darkMode ? '‚òÄÔ∏è' : 'üåô'}</span>
                    <span>{darkMode ? 'Light Mode' : 'Dark Mode'}</span>
                  </button>
                </div>
              )}
            </div>
          </nav>
          
          {/* Main Content */}
          <main className="container mx-auto px-4 py-8">
            {activeTab === 'home' && <HomeTab theme={theme} darkMode={darkMode} characters={characters} campaign={campaign} combat={combat} setActiveTab={setActiveTab} />}
            {activeTab === 'characters' && <CharactersTab theme={theme} characters={characters} setCharacters={setCharacters} />}
            {activeTab === 'combat' && <CombatTab theme={theme} characters={characters} setCharacters={setCharacters} combat={combat} setCombat={setCombat} />}
            {activeTab === 'dice' && <DiceTab theme={theme} />}
            {activeTab === 'reference' && <ReferenceTab theme={theme} />}
            {activeTab === 'lore' && <ItIsWrittenTab theme={theme} darkMode={darkMode} />}
          </main>

          {/* Footer */}
          <footer className={`${darkMode ? 'bg-gray-900 border-t border-gray-800' : 'bg-amber-900'} text-amber-100 text-center py-6 mt-12`}>
            <p className="text-sm">Nephilim Wars RPG - Digital Tabletop</p>
            <p className="text-xs mt-1 opacity-75">All data stored locally in your browser</p>
          </footer>
        </div>
      );
    };

    // ============================================
    // WORLD LORE COMPONENT (Home Page)
    // ============================================
    const WorldLore = ({ theme, darkMode }) => {
      const [expandedSection, setExpandedSection] = useState('premise');

      const loreContent = {
        premise: {
          title: "The Age of Giants",
          icon: "globe",
          content: `In the days before the Flood, when humanity was young upon the earth, the Watchers descended from heaven. Two hundred angels of the celestial host, led by Semyaza, abandoned their stations among the stars and took for themselves wives from among the daughters of men.

From these forbidden unions came the Nephilim‚Äîgiants of terrible might and insatiable hunger. Some stood tall as cedars; others walked as men but carried the fire of heaven in their eyes. They became tyrant-kings, warlords, and god-emperors who enslaved humanity and gorged themselves on the fruit of mortal labor.

The Watchers, too, transgressed further still. Azazel taught mankind the forging of weapons and the painting of faces. Shemihaza revealed the cutting of roots and herbs for sorcery. Baraqiel mapped the stars for divination. Knowledge meant only for heaven spilled into the world like poison into a well‚Äîand humanity drank deep.

Now the earth groans beneath corruption. Violence fills every corner of the land. The blood of the innocent cries out from the ground. And in the high places, the Nephilim raise their fists against the very throne of the Almighty.

But not all have bowed the knee to the giants. Not all have forgotten the name of the Most High.`
        },
        conflict: {
          title: "The War Unseen",
          icon: "sword",
          content: `The conflict spans both heaven and earth. Above, the faithful angels war against the Watchers who taught forbidden arts to their hybrid children. Below, scattered bands of the righteous resist the Nephilim kingdoms‚Äîstriking from wilderness strongholds, preserving the old ways, waiting for deliverance.

The Nephilim are not merely large. They are wrong‚Äîbeings that should not exist, souls that cannot find rest, flesh animated by something between mortal and divine. Some command the dark arts their fathers taught. Others have raised armies of human thralls who worship them as gods. A few, twisted by their impossible nature, have become something worse than either angel or man.

Between these forces stand the Player Characters: warriors, prophets, judges, and wanderers who have heard the call. Some are pure children of Adam, untouched by angelic blood. Others carry the taint of Nephilim ancestry themselves‚ÄîNephilim-Touched bloodlines who must wrestle with the corruption in their own veins. All must choose: Will they stand with heaven, or will they too be swept away in the judgment to come?

For judgment is coming. The Almighty has seen enough. The floodgates of heaven strain against divine wrath, and the deep cries out to be unleashed.

The only question is what you will do with the time that remains.`
        },
        factions: {
          title: "Powers of the Age",
          icon: "users",
          content: `THE NEPHILIM KINGDOMS ‚Äî Scattered across the known world, Nephilim warlords have carved out domains of terror and tribute. The greatest among them is Og of Bashan, whose iron bedstead stretches nine cubits long. In the east, the sons of Anak have built fortress-cities in the hill country. Along the coasts, half-breed sorcerer-kings traffic with entities from the abyss.

THE WATCHERS ‚Äî The fallen angels themselves rarely intervene directly, bound by ancient laws even they dare not break entirely. But they whisper through dreams, empower their children through dark rituals, and plot against both heaven and one another. Azazel schemes from his prison beneath Dudael. Semyaza broods upon Mount Hermon, awaiting the final confrontation.

THE FAITHFUL ‚Äî Enoch walked with God and was taken. His writings remain‚Äîprophecies of judgment and hope passed down through those who remember. The line of Seth maintains the old worship. Scattered priests preserve the sacrifices. Prophets hear the voice of the Most High and speak words that shake the foundations of giant-thrones. Methuselah still lives, oldest of all men, keeper of secrets from the world's first days.

THE CORRUPTED ‚Äî Not all humans resist. Many have embraced the new order‚Äîserving the Nephilim as soldiers, priests of false gods, or practitioners of the forbidden arts. The cities of Cain's descendants ring with forges making weapons for giant armies. The daughters of men who first lay with angels established mystery cults that persist to this day.`
        },
        themes: {
          title: "Covenant & Corruption",
          icon: "heart",
          content: `RIGHTEOUSNESS ‚Äî In this world, morality is not abstract. The Righteousness track measures your standing before heaven itself. The righteous can call upon divine power, invoke miracles, and resist the corrupting influence of the Nephilim. But righteousness is hard-won and easily lost. Every compromise, every forbidden act, every alliance with darkness moves you closer to becoming the very thing you fight.

THE COVENANT ‚Äî Before the Law, before Sinai, there was the simple covenant: walk with God, turn from wickedness, preserve life. Those who keep this ancient pact find themselves shielded from corruption and empowered for battle. Those who break it find heaven's silence deafening‚Äîand the whispers of the Watchers all too clear.

FORBIDDEN KNOWLEDGE ‚Äî The arts of the Watchers are powerful. Weapons forged by their methods strike truer. Sorcery learned from their teachings can bend reality. But every use of these gifts darkens the soul. Characters must choose: the hard path of faithfulness, or the quick power of corruption?

HOPE IN DARKNESS ‚Äî Despite the horrors of this age, hope persists. Prophecies speak of judgment‚Äîbut also of preservation. A remnant will survive. Seeds of redemption are being planted even now. Your characters may not live to see the rainbow after the storm, but their faithfulness matters. Every Nephilim brought low, every innocent protected, every act of courage in the face of giants‚Äîthese are not forgotten.

The Almighty sees. The Almighty remembers. And the Almighty acts.`
        }
      };

      return (
        <div className={`${theme.card} rounded-xl shadow-2xl overflow-hidden`}>
          <div className={`relative p-8 ${darkMode ? 'bg-gradient-to-br from-gray-800 via-gray-900 to-black' : 'bg-gradient-to-br from-amber-800 via-amber-900 to-amber-950'} text-white`}>
            <div className="absolute inset-0 opacity-20">
              <div className="absolute top-4 left-4 w-32 h-32 border border-amber-500/30 rounded-full"></div>
              <div className="absolute bottom-4 right-4 w-48 h-48 border border-amber-500/20 rounded-full"></div>
            </div>
            
            <div className="relative z-10">
              <div className="flex items-center gap-3 mb-2">
                <Icon name="eye" className="w-6 h-6 text-amber-400" />
                <span className="text-amber-400 text-sm font-semibold tracking-widest uppercase">The World of</span>
              </div>
              <h2 className="text-4xl md:text-5xl font-bold mb-3 tracking-tight">Nephilim Wars</h2>
              <p className="text-amber-200/80 text-lg italic max-w-2xl">
                "There were giants in the earth in those days; and also after that, when the sons of God came in unto the daughters of men..."
              </p>
              <p className="text-amber-300/60 text-sm mt-2">‚Äî Genesis 6:4</p>
            </div>
          </div>

          <div className="p-6 space-y-3">
            {Object.entries(loreContent).map(([key, section]) => (
              <div key={key} className={`${theme.bgTertiary} rounded-lg overflow-hidden border ${theme.border}`}>
                <button
                  onClick={() => setExpandedSection(expandedSection === key ? null : key)}
                  className={`w-full p-4 flex items-center justify-between transition-colors ${
                    expandedSection === key ? `${darkMode ? 'bg-amber-900/30' : 'bg-amber-200'}` : 'hover:bg-opacity-80'
                  }`}
                >
                  <div className="flex items-center gap-3">
                    <span className={theme.accentText}><Icon name={section.icon} /></span>
                    <h3 className={`text-lg font-bold ${theme.text}`}>{section.title}</h3>
                  </div>
                  <Icon name={expandedSection === key ? "chevron-up" : "chevron-down"} className={`w-5 h-5 ${theme.textMuted}`} />
                </button>
                
                {expandedSection === key && (
                  <div className={`p-6 ${theme.bgSecondary} border-t ${theme.border}`}>
                    <div className={`${theme.textSecondary} leading-relaxed whitespace-pre-line text-[15px]`}>
                      {section.content}
                    </div>
                  </div>
                )}
              </div>
            ))}
          </div>
        </div>
      );
    };

    // ============================================
    // HOME TAB
    // ============================================
    const HomeTab = ({ theme, darkMode, characters, campaign, combat, setActiveTab }) => (
      <div className="max-w-6xl mx-auto space-y-6">
        <WorldLore theme={theme} darkMode={darkMode} />

        <div className={`${theme.card} rounded-xl p-6 shadow-xl`}>
          <h3 className={`text-2xl font-bold ${theme.text} mb-4`}>Begin Your Journey</h3>
          <div className="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
            <QuickStartCard theme={theme} icon="users" title="Characters" desc="Create heroes" action={() => setActiveTab('characters')} />
            <QuickStartCard theme={theme} icon="sword" title="Combat" desc="Track battles" action={() => setActiveTab('combat')} />
            <QuickStartCard theme={theme} icon="dices" title="Dice" desc="Roll fate" action={() => setActiveTab('dice')} />
            <QuickStartCard theme={theme} icon="scroll" title="Reference" desc="Learn rules" action={() => setActiveTab('reference')} />
          </div>
        </div>

        <div className="grid md:grid-cols-2 gap-6">
          <div className={`${theme.card} rounded-xl p-6 shadow-xl`}>
            <h3 className={`text-2xl font-bold ${theme.text} mb-4`}>Quick Reference</h3>
            <div className="space-y-3">
              <RefCard theme={theme} title="Standard Check" content="1d20 + Attribute + Skill vs TN (10-25)" />
              <RefCard theme={theme} title="Attack Roll" content="1d20 + STR/DEX + Combat vs Defense" />
              <RefCard theme={theme} title="Righteousness" content="-10 (Corrupted) to +10 (Anointed)" />
            </div>
          </div>

          <div className={`${theme.card} rounded-xl p-6 shadow-xl`}>
            <h3 className={`text-2xl font-bold ${theme.text} mb-4`}>Campaign Stats</h3>
            <div className="grid grid-cols-2 gap-4">
              <StatBox theme={theme} label="Characters" value={characters.length} />
              <StatBox theme={theme} label="Total Levels" value={characters.reduce((s, c) => s + (c.level || 1), 0)} />
              <StatBox theme={theme} label="Sessions" value={campaign.sessions?.length || 0} />
              <StatBox theme={theme} label="Combat" value={combat.active ? 'Active' : 'Inactive'} />
            </div>
          </div>
        </div>
      </div>
    );

    const QuickStartCard = ({ theme, icon, title, desc, action }) => (
      <button
        onClick={action}
        className={`${theme.bgSecondary} p-6 rounded-xl shadow-lg hover:shadow-2xl transition-all border ${theme.border} hover:border-amber-500 text-left group`}
      >
        <div className="text-amber-400 mb-3 group-hover:scale-110 transition-transform">
          <Icon name={icon} className="w-8 h-8" />
        </div>
        <h3 className={`text-lg font-bold ${theme.text}`}>{title}</h3>
        <p className={`text-sm ${theme.textMuted}`}>{desc}</p>
      </button>
    );

    const RefCard = ({ theme, title, content }) => (
      <div className={`${theme.bgTertiary} p-4 rounded-lg border ${theme.border}`}>
        <h4 className={`font-bold ${theme.text} mb-1`}>{title}</h4>
        <p className={`text-sm ${theme.textSecondary}`}>{content}</p>
      </div>
    );

    const StatBox = ({ theme, label, value }) => (
      <div className={`${theme.bgTertiary} p-4 rounded-lg text-center border ${theme.border}`}>
        <div className={`text-3xl font-bold ${theme.accentText}`}>{value}</div>
        <div className={`text-sm ${theme.textMuted}`}>{label}</div>
      </div>
    );

    // ============================================
    // CHARACTERS TAB
    // ============================================
    const CharactersTab = ({ theme, characters, setCharacters }) => {
      const [creating, setCreating] = useState(false);
      const [currentCharacter, setCurrentCharacter] = useState(null);

      return (
        <div className="max-w-6xl mx-auto">
          <div className="flex justify-between items-center mb-6">
            <h2 className={`text-3xl font-bold ${theme.text}`}>Characters</h2>
            <button
              onClick={() => setCreating(true)}
              className={`${theme.accent} ${theme.accentHover} text-white px-6 py-3 rounded-lg flex items-center gap-2 shadow-lg transition-all`}
            >
              <Icon name="plus" className="w-5 h-5" />
              <span>New Character</span>
            </button>
          </div>

          {creating ? (
            <CharacterCreator 
              theme={theme}
              onComplete={(char) => {
                setCharacters([...characters, char]);
                setCreating(false);
              }} 
              onCancel={() => setCreating(false)} 
            />
          ) : currentCharacter ? (
            <CharacterSheet 
              theme={theme}
              character={currentCharacter}
              onUpdate={(updated) => {
                const idx = characters.findIndex(c => c.id === updated.id);
                const newChars = [...characters];
                newChars[idx] = updated;
                setCharacters(newChars);
                setCurrentCharacter(updated);
              }}
              onClose={() => setCurrentCharacter(null)}
            />
          ) : (
            <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-6">
              {characters.map((char, idx) => (
                <CharacterCard 
                  key={idx}
                  theme={theme}
                  character={char} 
                  onSelect={() => setCurrentCharacter(char)}
                  onDelete={() => setCharacters(characters.filter((_, i) => i !== idx))}
                />
              ))}
              {characters.length === 0 && (
                <div className="col-span-full text-center py-12">
                  <Icon name="users" className={`w-24 h-24 ${theme.textMuted} mx-auto mb-4`} />
                  <p className={theme.textMuted}>No characters yet. Create your first hero!</p>
                </div>
              )}
            </div>
          )}
        </div>
      );
    };

    const CharacterCard = ({ theme, character, onSelect, onDelete }) => {
      const xpToNext = character.level * 50;
      const xpProgress = (character.xp % xpToNext) / xpToNext * 100;
      
      // NEW: Dynamic HP calculation for color
      const hpPercent = (character.currentHP / character.maxHP) * 100;
      let hpColor = 'bg-green-500';
      if (hpPercent <= 50) hpColor = 'bg-yellow-500';
      if (hpPercent <= 25) hpColor = 'bg-red-500';
      
      const cpPercent = (character.currentCP / character.maxCP) * 100;

      return (
        <div className={`${theme.card} rounded-xl shadow-xl p-6 hover:shadow-2xl transition-all`}>
          <div className="flex justify-between items-start mb-4">
            <div>
              <h3 className={`text-xl font-bold ${theme.text}`}>{character.name}</h3>
              <p className={`text-sm ${theme.textSecondary}`}>{character.bloodline}</p>
              <p className={`text-sm ${theme.accentText}`}>{character.calling}</p>
            </div>
            <button onClick={onDelete} className="text-red-500 hover:text-red-400 p-2">
              <Icon name="trash-2" className="w-5 h-5" />
            </button>
          </div>
          
          <div className="space-y-2 mb-4">
            {/* XP/Level Progress */}
            <div className="flex justify-between text-sm">
              <span className={theme.textSecondary}>Level {character.level}</span>
              <span className={theme.textSecondary}>{character.xp} XP</span>
            </div>
            <div className="w-full bg-gray-700 rounded-full h-2">
              <div className="bg-amber-500 h-2 rounded-full" style={{ width: `${xpProgress}%` }}></div>
            </div>
            
            {/* NEW: Dynamic HP Bar */}
            <div className="pt-3">
              <div className="flex justify-between text-sm">
                  <span className={theme.textMuted}>Hit Points</span>
                  {character.currentHP === 0 ? (
                      <span className="text-red-500 font-bold">DOWN</span>
                  ) : hpPercent <= 25 ? (
                      <span className="text-red-500 font-bold">Wounded!</span>
                  ) : (
                      <span className={`font-bold ${theme.text}`}>{character.currentHP}/{character.maxHP}</span>
                  )}
              </div>
              <div className="w-full bg-gray-700 rounded-full h-3 mt-1">
                  <div className={`${hpColor} h-3 rounded-full transition-all duration-500`} style={{ width: `${hpPercent}%` }}></div>
              </div>
            </div>
            
            {/* NEW: Dynamic CP Bar */}
            <div className="pt-1">
              <div className="flex justify-between text-sm">
                  <span className={theme.textMuted}>Covenant Points</span>
                  <span className={`font-bold ${theme.text}`}>{character.currentCP}/{character.maxCP}</span>
              </div>
              <div className="w-full bg-gray-700 rounded-full h-2 mt-1">
                  <div className="bg-blue-500 h-2 rounded-full" style={{ width: `${cpPercent}%` }}></div>
              </div>
            </div>
          </div>

          {/* Old Stat Grid (kept for consistency with other data) */}
          <div className="grid grid-cols-2 gap-2 mb-4 text-sm">
            <div className={`${theme.bgTertiary} p-2 rounded text-center`}>
              <div className={theme.textMuted}>Right</div>
              <div className={`font-bold ${theme.text}`}>{character.righteousness > 0 ? '+' : ''}{character.righteousness}</div>
            </div>
            <div className={`${theme.bgTertiary} p-2 rounded text-center`}>
              <div className={theme.textMuted}>Def</div>
              <div className={`font-bold ${theme.text}`}>{character.defense}</div>
            </div>
          </div>

          <button
            onClick={onSelect}
            className={`w-full ${theme.accent} ${theme.accentHover} text-white py-2 rounded-lg font-bold`}
          >
            View Sheet
          </button>
        </div>
      );
    };

    // ============================================
    // CHARACTER CREATOR (Balanced D&D 5e Style)
    // ============================================
    const CharacterCreator = ({ theme, onComplete, onCancel }) => {
      const POINT_COSTS = { 8: 0, 9: 1, 10: 2, 11: 3, 12: 4, 13: 5, 14: 7, 15: 9 };
      const TOTAL_POINTS = 27;

      const [formData, setFormData] = useState({
        name: '',
        bloodline: 'Seed of Adam',
        calling: 'Warrior',
        str: 8, con: 8, dex: 8, wis: 8, cun: 8, fai: 8
      });

      const bloodlineBonuses = {
        'Seed of Adam': { con: 1, wis: 1, righteousness: 1, desc: '+1 CON, +1 WIS, +1 Righteousness' },
        'Canaanite Convert': { cun: 1, fai: 1, righteousness: 0, desc: '+1 CUN, +1 FAI' },
        'Nephilim-Touched': { str: 2, con: 1, righteousness: -2, desc: '+2 STR, +1 CON, -2 Righteousness' },
        'Levitical Line': { wis: 1, fai: 2, righteousness: 2, desc: '+1 WIS, +2 FAI, +2 Righteousness' }
      };

      const callingBonuses = {
        'Warrior': { str: 1, desc: '+1 STR' },
        'Prophet/Seer': { wis: 1, desc: '+1 WIS' },
        'Judge/Leader': { cun: 1, desc: '+1 CUN' },
        'Scout/Ranger': { dex: 1, desc: '+1 DEX' },
        'Scholar/Scribe': { wis: 1, desc: '+1 WIS' },
        'Shepherd/Commoner': { con: 1, desc: '+1 CON' },
        'Worshipping Servant': { fai: 1, desc: '+1 FAI' }
      };

      const standardArrays = {
        'Balanced': { str: 13, con: 12, dex: 12, wis: 12, cun: 10, fai: 10 },
        'Specialized': { str: 15, con: 14, dex: 13, wis: 10, cun: 8, fai: 8 },
        'Well-Rounded': { str: 12, con: 12, dex: 12, wis: 12, cun: 12, fai: 11 },
        'Faithful': { str: 10, con: 12, dex: 10, wis: 14, cun: 10, fai: 15 }
      };

      const calculateMod = (val) => Math.floor((val - 10) / 2);

      const getPointsSpent = () => {
        return ['str', 'con', 'dex', 'wis', 'cun', 'fai'].reduce((total, attr) => {
          return total + POINT_COSTS[formData[attr]];
        }, 0);
      };

      const pointsRemaining = TOTAL_POINTS - getPointsSpent();

      const adjustAttr = (attr, change) => {
        const current = formData[attr];
        const newVal = current + change;
        
        if (newVal < 8 || newVal > 15) return;
        
        const newCost = POINT_COSTS[newVal];
        const oldCost = POINT_COSTS[current];
        const costDiff = newCost - oldCost;
        
        if (costDiff > pointsRemaining) return;

        setFormData({ ...formData, [attr]: newVal });
      };

      const applyStandardArray = (arrayName) => {
        setFormData({ ...formData, ...standardArrays[arrayName] });
      };

      const getFinalStat = (attr) => {
        const base = formData[attr];
        const bloodlineBonus = bloodlineBonuses[formData.bloodline][attr] || 0;
        const callBonus = callingBonuses[formData.calling][attr] || 0;
        return base + bloodlineBonus + callBonus;
      };

      const previewStats = () => {
        const finalCon = getFinalStat('con');
        const finalFai = getFinalStat('fai');
        const finalDex = getFinalStat('dex');
        const finalWis = getFinalStat('wis');
        
        const conMod = calculateMod(finalCon);
        const faiMod = calculateMod(finalFai);
        const dexMod = calculateMod(finalDex);
        const wisMod = calculateMod(finalWis);

        return {
          hpRange: `${10 + (conMod * 3) + 1}-${10 + (conMod * 3) + 8}`,
          cp: Math.max(1, 3 + faiMod),
          defense: 10 + dexMod,
          initiative: dexMod + wisMod,
          righteousness: bloodlineBonuses[formData.bloodline].righteousness || 0
        };
      };

      const preview = previewStats();

      const finishCharacter = () => {
        const finalStats = {
          str: getFinalStat('str'),
          con: getFinalStat('con'),
          dex: getFinalStat('dex'),
          wis: getFinalStat('wis'),
          cun: getFinalStat('cun'),
          fai: getFinalStat('fai')
        };

        const conMod = calculateMod(finalStats.con);
        const faiMod = calculateMod(finalStats.fai);
        // const dexMod = calculateMod(finalStats.dex); // Not needed for final calc
        // const wisMod = calculateMod(finalStats.wis); // Not needed for final calc

        const baseHP = 10 + (conMod * 3) + Math.floor(Math.random() * 8) + 1;
        const baseCP = Math.max(1, 3 + faiMod);

        const skillsByClass = {
          'Warrior': { 'Melee Combat': 3, 'Intimidation': 2, 'Endurance': 2 },
          'Prophet/Seer': { 'Divine Sense': 3, 'Lore': 2, 'Persuasion': 2 },
          'Judge/Leader': { 'Command': 3, 'Persuasion': 2, 'Lore': 2 },
          'Scout/Ranger': { 'Ranged Combat': 3, 'Stealth': 2, 'Survival': 2 },
          'Scholar/Scribe': { 'Lore': 3, 'Languages': 2, 'Divine Sense': 2 },
          'Shepherd/Commoner': { 'Survival': 3, 'Animal Handling': 2, 'Endurance': 2 },
          'Worshipping Servant': { 'Sacred Music': 3, 'Divine Sense': 2, 'Persuasion': 2 }
        };

        const equipmentByClass = {
          'Warrior': ['Bronze Sword (Medium)', 'Wooden Shield', 'Leather Armor', 'Waterskin'],
          'Prophet/Seer': ['Walking Staff (Light)', 'Holy Symbol', 'Scrolls', 'Waterskin'],
          'Judge/Leader': ['Bronze Mace (Medium)', 'Fine Robes', 'Signet Ring', 'Waterskin'],
          'Scout/Ranger': ['Sling (Ranged)', 'Hunting Knife (Light)', 'Rope', 'Waterskin'],
          'Scholar/Scribe': ['Knife (Light)', 'Writing Kit', 'Scrolls', 'Waterskin'],
          'Shepherd/Commoner': ['Crook (Light)', 'Sling (Ranged)', 'Provisions', 'Waterskin'],
          'Worshipping Servant': ['Kinnor (Lyre)', 'Holy Symbol', 'Anointing Oil', 'Waterskin']
        };

        onComplete({
          id: Date.now(),
          name: formData.name,
          bloodline: formData.bloodline,
          calling: formData.calling,
          ...finalStats,
          maxHP: baseHP,
          currentHP: baseHP,
          maxCP: baseCP,
          currentCP: baseCP,
          defense: 10 + calculateMod(finalStats.dex),
          initiative: calculateMod(finalStats.dex) + calculateMod(finalStats.wis),
          righteousness: bloodlineBonuses[formData.bloodline].righteousness || 0,
          level: 1,
          xp: 0,
          skills: skillsByClass[formData.calling] || {},
          equipment: equipmentByClass[formData.calling] || ['Simple Weapon', 'Waterskin']
        });
      };

      const attrDescriptions = {
        str: 'Melee damage, carrying',
        con: 'Hit points, endurance',
        dex: 'Defense, ranged, initiative',
        wis: 'Perception, divine sense',
        cun: 'Deception, tactics',
        fai: 'Covenant points, miracles'
      };

      return (
        <div className={`${theme.card} rounded-xl p-6 md:p-8 max-w-5xl mx-auto`}>
          <h3 className={`text-3xl font-bold ${theme.text} mb-2`}>Create Character</h3>
          <p className={`${theme.textMuted} mb-6`}>Allocate 27 points across your attributes (8-15 range)</p>
          
          <div className="space-y-6">
            <div>
              <label className={`block ${theme.text} font-bold mb-2`}>Name</label>
              <input
                type="text"
                value={formData.name}
                onChange={(e) => setFormData({...formData, name: e.target.value})}
                className={`w-full border-2 ${theme.input} rounded-lg p-3 focus:outline-none focus:border-amber-500`}
                placeholder="Character name..."
              />
            </div>

            <div className="grid md:grid-cols-2 gap-4">
              <div>
                <label className={`block ${theme.text} font-bold mb-2`}>Bloodline</label>
                <select
                  value={formData.bloodline}
                  onChange={(e) => setFormData({...formData, bloodline: e.target.value})}
                  className={`w-full border-2 ${theme.input} rounded-lg p-3 focus:outline-none focus:border-amber-500`}
                >
                  <option value="Seed of Adam">Seed of Adam</option>
                  <option value="Canaanite Convert">Canaanite Convert</option>
                  <option value="Nephilim-Touched">Nephilim-Touched</option>
                  <option value="Levitical Line">Levitical Line</option>
                </select>
                <p className={`text-sm ${theme.accentText} mt-1`}>{bloodlineBonuses[formData.bloodline].desc}</p>
              </div>

              <div>
                <label className={`block ${theme.text} font-bold mb-2`}>Calling</label>
                <select
                  value={formData.calling}
                  onChange={(e) => setFormData({...formData, calling: e.target.value})}
                  className={`w-full border-2 ${theme.input} rounded-lg p-3 focus:outline-none focus:border-amber-500`}
                >
                  <option>Warrior</option>
                  <option>Prophet/Seer</option>
                  <option>Judge/Leader</option>
                  <option>Scout/Ranger</option>
                  <option>Scholar/Scribe</option>
                  <option>Shepherd/Commoner</option>
                  <option>Worshipping Servant</option>
                </select>
                <p className={`text-sm ${theme.accentText} mt-1`}>{callingBonuses[formData.calling].desc}</p>
              </div>
            </div>

            <div>
              <label className={`block ${theme.text} font-bold mb-2`}>Quick Start (Standard Arrays)</label>
              <div className="flex flex-wrap gap-2">
                {Object.keys(standardArrays).map(name => (
                  <button
                    key={name}
                    onClick={() => applyStandardArray(name)}
                    className={`px-4 py-2 rounded-lg border ${theme.border} ${theme.bgTertiary} ${theme.text} hover:border-amber-500 transition-colors text-sm`}
                  >
                    {name}
                  </button>
                ))}
              </div>
            </div>

            <div>
              <div className="flex justify-between items-center mb-3">
                <label className={`${theme.text} font-bold`}>Attributes</label>
                <span className={`${pointsRemaining < 0 ? 'text-red-500' : pointsRemaining === 0 ? 'text-green-500' : theme.accentText} font-bold`}>
                  Points: {pointsRemaining} / {TOTAL_POINTS}
                </span>
              </div>
              
              <div className="grid md:grid-cols-2 lg:grid-cols-3 gap-3">
                {['str', 'con', 'dex', 'wis', 'cun', 'fai'].map(attr => {
                  const baseVal = formData[attr];
                  const finalVal = getFinalStat(attr);
                  const bonus = finalVal - baseVal;
                  const mod = calculateMod(finalVal);
                  const cost = POINT_COSTS[baseVal];
                  
                  return (
                    <div key={attr} className={`${theme.bgTertiary} rounded-lg p-4 border ${theme.border}`}>
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <span className={`font-bold ${theme.text} text-lg`}>{attr.toUpperCase()}</span>
                          <p className={`text-xs ${theme.textMuted}`}>{attrDescriptions[attr]}</p>
                        </div>
                        <span className={`text-xs ${theme.textMuted} bg-gray-600 px-2 py-1 rounded`}>{cost} pts</span>
                      </div>
                      
                      <div className="flex items-center justify-between">
                        <button
                          onClick={() => adjustAttr(attr, -1)}
                          disabled={baseVal <= 8}
                          className="w-10 h-10 bg-red-600 rounded-lg hover:bg-red-700 font-bold text-white disabled:bg-gray-600 disabled:cursor-not-allowed"
                        >
                          ‚àí
                        </button>
                        
                        <div className="text-center">
                          <div className="flex items-center justify-center gap-1">
                            <span className={`font-bold text-2xl ${theme.text}`}>{baseVal}</span>
                            {bonus > 0 && (
                              <span className="text-green-400 text-sm">+{bonus}</span>
                            )}
                            <span className={`font-bold text-2xl ${theme.text}`}>= {finalVal}</span>
                          </div>
                          <div className={`text-sm font-bold ${mod >= 0 ? 'text-green-400' : 'text-red-400'}`}>
                            ({mod >= 0 ? '+' : ''}{mod})
                          </div>
                        </div>
                        
                        <button
                          onClick={() => adjustAttr(attr, 1)}
                          disabled={baseVal >= 15 || POINT_COSTS[baseVal + 1] - POINT_COSTS[baseVal] > pointsRemaining}
                          className="w-10 h-10 bg-green-600 rounded-lg hover:bg-green-700 font-bold text-white disabled:bg-gray-600 disabled:cursor-not-allowed"
                        >
                          +
                        </button>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>

            <div className={`${theme.bgTertiary} rounded-lg p-4 border ${theme.border}`}>
              <h4 className={`font-bold ${theme.text} mb-3`}>Character Preview</h4>
              <div className="grid grid-cols-2 md:grid-cols-5 gap-3 text-center">
                <div>
                  <div className={`text-xs ${theme.textMuted}`}>Hit Points</div>
                  <div className={`font-bold ${theme.text}`}>{preview.hpRange}</div>
                </div>
                <div>
                  <div className={`text-xs ${theme.textMuted}`}>Covenant Pts</div>
                  <div className={`font-bold ${theme.text}`}>{preview.cp}</div>
                </div>
                <div>
                  <div className={`text-xs ${theme.textMuted}`}>Defense</div>
                  <div className={`font-bold ${theme.text}`}>{preview.defense}</div>
                </div>
                <div>
                  <div className={`text-xs ${theme.textMuted}`}>Initiative</div>
                  <div className={`font-bold ${theme.text}`}>+{preview.initiative}</div>
                </div>
                <div>
                  <div className={`text-xs ${theme.textMuted}`}>Righteousness</div>
                  <div className={`font-bold ${preview.righteousness >= 0 ? 'text-blue-400' : 'text-red-400'}`}>
                    {preview.righteousness >= 0 ? '+' : ''}{preview.righteousness}
                  </div>
                </div>
              </div>
            </div>

            <div className="flex gap-3">
              <button
                onClick={finishCharacter}
                disabled={!formData.name || pointsRemaining !== 0}
                className={`flex-1 ${theme.accent} ${theme.accentHover} text-white py-3 rounded-lg font-bold disabled:bg-gray-600 disabled:cursor-not-allowed transition-colors`}
              >
                {pointsRemaining > 0 ? `Spend ${pointsRemaining} More Points` : pointsRemaining < 0 ? 'Over Budget!' : 'Create Character'}
              </button>
              <button
                onClick={onCancel}
                className="flex-1 bg-gray-600 text-white py-3 rounded-lg font-bold hover:bg-gray-700 transition-colors"
              >
                Cancel
              </button>
            </div>
          </div>
        </div>
      );
    };

 // ============================================
    // CHARACTER SHEET (Fixed Close Button)
    // ============================================
    const CharacterSheet = ({ theme, character, onUpdate, onClose }) => {
      const calculateMod = (val) => Math.floor((val - 10) / 2);
      
      const adjustHP = (amt) => {
        const newHP = Math.max(0, Math.min(character.maxHP, character.currentHP + amt));
        onUpdate({ ...character, currentHP: newHP });
      };

      const adjustCP = (amt) => {
        const newCP = Math.max(0, Math.min(character.maxCP, character.currentCP + amt));
        onUpdate({ ...character, currentCP: newCP });
      };

      const adjustXP = (amt) => {
        const newXP = Math.max(0, character.xp + amt);
        const xpToNext = character.level * 50;
        let newLevel = character.level;
        
        if (newXP >= xpToNext) {
          newLevel = character.level + 1;
        }
        
        onUpdate({ ...character, xp: newXP, level: newLevel });
      };

      return (
        <div className="fixed inset-0 bg-black bg-opacity-75 flex items-center justify-center p-4 z-50 overflow-y-auto">
          <div className={`${theme.bgSecondary} rounded-xl shadow-2xl max-w-5xl w-full my-8 relative`}>
            
            {/* Header with Top Close Button */}
            <div className={`sticky top-0 ${theme.accent} text-white p-6 flex justify-between items-center rounded-t-xl z-20 shadow-md`}>
              <div>
                <h3 className="text-3xl font-bold">{character.name}</h3>
                <p className="text-amber-200">{character.bloodline} ‚Ä¢ {character.calling}</p>
              </div>
              <button 
                onClick={onClose} 
                className="p-2 bg-black/20 hover:bg-black/40 rounded-lg transition-colors border border-white/20"
                title="Close Sheet"
              >
                <Icon name="x" className="w-6 h-6 text-white" />
              </button>
            </div>

            <div className="p-6 space-y-6">
              {/* Stats Row 1: Level / XP / Righteousness */}
              <div className="grid md:grid-cols-3 gap-4">
                <div className={`${theme.card} p-4 rounded-lg`}>
                  <div className={`text-sm ${theme.textMuted} mb-1`}>Level</div>
                  <div className={`text-3xl font-bold ${theme.text}`}>{character.level}</div>
                </div>
                <div className={`${theme.card} p-4 rounded-lg`}>
                  <div className={`text-sm ${theme.textMuted} mb-1`}>Experience</div>
                  <div className="flex items-center gap-2">
                    <button onClick={() => adjustXP(-10)} className="px-2 py-1 bg-red-600 rounded text-white text-sm">-10</button>
                    <div className={`text-2xl font-bold ${theme.text} flex-1 text-center`}>{character.xp}</div>
                    <button onClick={() => adjustXP(10)} className="px-2 py-1 bg-green-600 rounded text-white text-sm">+10</button>
                  </div>
                </div>
                <div className={`${theme.card} p-4 rounded-lg`}>
                  <div className={`text-sm ${theme.textMuted} mb-1`}>Righteousness</div>
                  <div className={`text-3xl font-bold ${theme.text}`}>
                    {character.righteousness > 0 ? '+' : ''}{character.righteousness}
                  </div>
                </div>
              </div>

              {/* Stats Row 2: HP / CP */}
              <div className="grid md:grid-cols-2 gap-4">
                <div className={`${theme.card} p-4 rounded-lg`}>
                  <div className="flex justify-between items-center mb-2">
                    <span className={`font-bold ${theme.text}`}>Hit Points</span>
                    <span className={`text-2xl font-bold ${theme.text}`}>{character.currentHP} / {character.maxHP}</span>
                  </div>
                  <div className="flex gap-2 mb-2">
                    <button onClick={() => adjustHP(-5)} className="px-3 py-1 bg-red-600 text-white rounded font-bold">-5</button>
                    <button onClick={() => adjustHP(-1)} className="px-3 py-1 bg-red-600 text-white rounded font-bold">-1</button>
                    <button onClick={() => adjustHP(1)} className="px-3 py-1 bg-green-600 text-white rounded font-bold">+1</button>
                    <button onClick={() => adjustHP(5)} className="px-3 py-1 bg-green-600 text-white rounded font-bold">+5</button>
                  </div>
                  {/* Dynamic HP bar with color */}
                  <div className="w-full bg-gray-700 rounded-full h-3">
                    <div className={`${(character.currentHP / character.maxHP) * 100 <= 25 ? 'bg-red-500' : (character.currentHP / character.maxHP) * 100 <= 50 ? 'bg-yellow-500' : 'bg-green-500'} h-3 rounded-full transition-all duration-500`} style={{ width: `${(character.currentHP / character.maxHP) * 100}%` }}></div>
                  </div>
                </div>

                <div className={`${theme.card} p-4 rounded-lg`}>
                  <div className="flex justify-between items-center mb-2">
                    <span className={`font-bold ${theme.text}`}>Covenant Points</span>
                    <span className={`text-2xl font-bold ${theme.text}`}>{character.currentCP} / {character.maxCP}</span>
                  </div>
                  <div className="flex gap-2 mb-2">
                    <button onClick={() => adjustCP(-1)} className="px-3 py-1 bg-red-600 text-white rounded font-bold">-1</button>
                    <button onClick={() => adjustCP(1)} className="px-3 py-1 bg-green-600 text-white rounded font-bold">+1</button>
                    <button onClick={() => adjustCP(character.maxCP - character.currentCP)} className="px-3 py-1 bg-blue-600 text-white rounded font-bold">Full</button>
                  </div>
                  <div className="w-full bg-gray-700 rounded-full h-3">
                    <div className="bg-blue-500 h-3 rounded-full" style={{ width: `${(character.currentCP / character.maxCP) * 100}%` }}></div>
                  </div>
                </div>
              </div>

              {/* Attributes Grid */}
              <div className={`${theme.card} p-6 rounded-lg`}>
                <h4 className={`text-xl font-bold ${theme.text} mb-4`}>Attributes</h4>
                <div className="grid grid-cols-3 md:grid-cols-6 gap-3">
                  {[
                    { name: 'STR', val: character.str },
                    { name: 'CON', val: character.con },
                    { name: 'DEX', val: character.dex },
                    { name: 'WIS', val: character.wis },
                    { name: 'CUN', val: character.cun },
                    { name: 'FAI', val: character.fai }
                  ].map(attr => {
                    const mod = calculateMod(attr.val);
                    return (
                      <div key={attr.name} className={`${theme.bgTertiary} p-3 rounded-lg text-center border ${theme.border}`}>
                        <div className={`text-xs ${theme.textMuted}`}>{attr.name}</div>
                        <div className={`text-2xl font-bold ${theme.text}`}>{attr.val}</div>
                        <div className={`text-sm ${theme.textSecondary}`}>({mod >= 0 ? '+' : ''}{mod})</div>
                      </div>
                    );
                  })}
                </div>
              </div>

              {/* Skills & Equipment */}
              <div className="grid md:grid-cols-2 gap-4">
                <div className={`${theme.card} p-6 rounded-lg`}>
                  <h4 className={`text-xl font-bold ${theme.text} mb-4`}>Skills</h4>
                  <div className="space-y-2">
                    {Object.entries(character.skills || {}).map(([skill, bonus]) => (
                      <div key={skill} className={`${theme.bgTertiary} p-3 rounded-lg flex justify-between border ${theme.border}`}>
                        <span className={theme.text}>{skill}</span>
                        <span className={`font-bold ${theme.accentText}`}>+{bonus}</span>
                      </div>
                    ))}
                  </div>
                </div>

                <div className={`${theme.card} p-6 rounded-lg`}>
                  <h4 className={`text-xl font-bold ${theme.text} mb-4`}>Equipment</h4>
                  <div className="space-y-2">
                    {character.equipment?.map((item, idx) => (
                      <div key={idx} className={`${theme.bgTertiary} p-3 rounded-lg border ${theme.border}`}>
                        <span className={theme.text}>{item}</span>
                      </div>
                    ))}
                  </div>
                </div>
              </div>

              {/* Defense & Initiative */}
              <div className="grid md:grid-cols-2 gap-3">
                <div className={`${theme.card} p-4 rounded-lg text-center`}>
                  <div className={`text-sm ${theme.textMuted}`}>Defense</div>
                  <div className={`text-3xl font-bold ${theme.text}`}>{character.defense}</div>
                </div>
                <div className={`${theme.card} p-4 rounded-lg text-center`}>
                  <div className={`text-sm ${theme.textMuted}`}>Initiative</div>
                  <div className={`text-3xl font-bold ${theme.text}`}>+{character.initiative}</div>
                </div>
              </div>

              {/* BOTTOM CLOSE BUTTON - THE FIX */}
              <div className="pt-4 mt-6 border-t border-gray-700">
                <button 
                    onClick={onClose}
                    className={`w-full py-4 rounded-lg font-bold text-lg shadow-lg flex items-center justify-center gap-2 ${theme.accent} text-white hover:brightness-110 transition-all`}
                >
                    <Icon name="x" className="w-5 h-5" />
                    Close Character Sheet
                </button>
              </div>

            </div>
          </div>
        </div>
      );
    };
    // ============================================
    // COMBAT TAB (REWRITTEN & FIXED)
    // ============================================
    const CombatTab = ({ theme, characters, setCharacters, combat, setCombat }) => {
      const [showModal, setShowModal] = useState(false);
      const [selectedCat, setSelectedCat] = useState('giants');
      const [selectedIdx, setSelectedIdx] = useState(0);

      // Handle category change to reset index
      const handleCatChange = (e) => {
        setSelectedCat(e.target.value);
        setSelectedIdx(0);
      };

      const startCombat = () => {
        const combatants = characters.map(char => ({
          ...char,
          initiative: Math.floor(Math.random() * 20) + 1 + (char.initiative || 0),
          type: 'player'
        }));
        setCombat({ active: true, combatants: combatants.sort((a, b) => b.initiative - a.initiative), round: 1, currentTurn: 0 });
      };

      const handleAddEnemy = () => {
        const creature = BESTIARY_DATA[selectedCat].creatures[selectedIdx];
        if(!creature) return;

        const newEnemy = {
          id: Date.now(),
          name: creature.name,
          maxHP: creature.hp,
          currentHP: creature.hp,
          defense: creature.def,
          initiative: Math.floor(Math.random() * 20) + 1,
          type: 'enemy',
          attack: creature.attack,
          special: creature.special,
          image: creature.image // Pull image directly from bestiary
        };

        const newCombatants = [...combat.combatants, newEnemy].sort((a, b) => b.initiative - a.initiative);
        setCombat({ ...combat, combatants: newCombatants });
        setShowModal(false);
      };

      const adjustCombatantHP = (id, amount) => {
        const updated = combat.combatants.map(c => c.id === id ? { ...c, currentHP: Math.max(0, Math.min(c.maxHP, c.currentHP + amount)) } : c);
        setCombat({ ...combat, combatants: updated });
        const char = characters.find(ch => ch.id === id);
        if (char) {
          setCharacters(characters.map(c => c.id === id ? { ...c, currentHP: Math.max(0, Math.min(c.maxHP, c.currentHP + amount)) } : c));
        }
      };

      const removeCombatant = (id) => {
        setCombat({ ...combat, combatants: combat.combatants.filter(c => c.id !== id) });
      };

      const nextTurn = () => {
        const nextIdx = (combat.currentTurn + 1) % combat.combatants.length;
        const newRound = nextIdx === 0 ? combat.round + 1 : combat.round;
        setCombat({ ...combat, currentTurn: nextIdx, round: newRound });
      };

      if (!combat.active) {
        return (
          <div className="max-w-4xl mx-auto text-center">
            <div className={`${theme.card} rounded-xl shadow-2xl p-12`}>
              <Icon name="sword" className="w-24 h-24 mx-auto text-amber-500 mb-6" />
              <h2 className={`text-3xl font-bold ${theme.text} mb-4`}>Combat Tracker</h2>
              <button onClick={startCombat} disabled={characters.length === 0} className={`${theme.accent} ${theme.accentHover} text-white px-8 py-4 rounded-lg text-xl font-bold disabled:bg-gray-600 shadow-lg`}>
                {characters.length === 0 ? 'Create Characters First' : 'Start Combat'}
              </button>
            </div>
          </div>
        );
      }

      return (
        <div className="max-w-6xl mx-auto">
          {/* Combat Header */}
          <div className={`${theme.accent} text-white rounded-xl p-6 mb-6 flex flex-col md:flex-row justify-between items-center gap-4 shadow-xl`}>
            <div><h2 className="text-2xl font-bold">Combat Active</h2><p>Round {combat.round}</p></div>
            <div className="flex gap-2 flex-wrap">
              <button onClick={() => setShowModal(true)} className="bg-red-600 px-4 py-2 rounded-lg hover:bg-red-700 font-bold flex items-center gap-2"><Icon name="plus" /> Add Enemy</button>
              <button onClick={nextTurn} className="bg-green-600 px-4 py-2 rounded-lg hover:bg-green-700 font-bold">Next Turn</button>
              <button onClick={() => setCombat({ active: false, combatants: [] })} className="bg-gray-600 px-4 py-2 rounded-lg hover:bg-gray-700 font-bold">End</button>
            </div>
          </div>

          {/* Combat List */}
          <div className="space-y-4">
            {combat.combatants.map((combatant, idx) => {
              return (
                <div key={combatant.id} className={`rounded-xl p-5 shadow-xl border-4 transition-all duration-300 ${idx === combat.currentTurn ? 'border-amber-500 bg-amber-900/20 scale-[1.01]' : `border-transparent ${theme.card}`} ${combatant.currentHP === 0 ? 'opacity-50' : ''}`}>
                  
                  {/* Stats Row */}
                  <div className="flex flex-col md:flex-row gap-4 justify-between items-start mb-4">
                     <div className="flex-1">
                        <div className="flex items-center gap-3 mb-2">
                           {idx === combat.currentTurn && <Icon name="zap" className="w-5 h-5 text-amber-500 animate-bounce-y" />} 
                           <h3 className={`text-2xl font-bold ${theme.text}`}>{combatant.name}</h3>
                           <span className={`px-2 py-1 rounded text-xs font-bold ${combatant.type === 'player' ? 'bg-blue-500/30 text-blue-400' : 'bg-red-500/30 text-red-400'}`}>
                             {combatant.type === 'player' ? 'PLAYER' : 'ENEMY'}
                           </span>
                        </div>
                        
                        <div className="flex gap-4 text-sm mb-2">
                           <span className={`${theme.bgTertiary} px-3 py-1 rounded`}><strong>Init:</strong> {combatant.initiative}</span>
                           <span className={`${theme.bgTertiary} px-3 py-1 rounded`}><strong>Def:</strong> {combatant.defense}</span>
                        </div>
                        
                        {(combatant.attack || combatant.special) && (
                            <div className="text-sm mt-2">
                               {combatant.attack && <div className={theme.textSecondary}><strong className={theme.text}>Attack:</strong> {combatant.attack}</div>}
                               {combatant.special && <div className={theme.textSecondary}><strong className={theme.text}>Special:</strong> {combatant.special}</div>}
                            </div>
                        )}
                     </div>

                     {/* HP Controls */}
                     <div className="flex flex-col items-end gap-2">
                        <div className="text-right">
                           <div className={`text-sm ${theme.textMuted}`}>HP</div>
                           <div className={`text-3xl font-bold ${theme.text}`}>{combatant.currentHP} / {combatant.maxHP}</div>
                        </div>
                        <div className="flex gap-1">
                           <button onClick={() => adjustCombatantHP(combatant.id, -5)} className="px-3 py-1 bg-red-600 text-white rounded font-bold">-5</button>
                           <button onClick={() => adjustCombatantHP(combatant.id, -1)} className="px-3 py-1 bg-red-600 text-white rounded font-bold">-1</button>
                           <button onClick={() => adjustCombatantHP(combatant.id, 1)} className="px-3 py-1 bg-green-600 text-white rounded font-bold">+1</button>
                        </div>
                        <button onClick={() => removeCombatant(combatant.id)} className="text-gray-500 hover:text-red-500 text-sm flex items-center gap-1 mt-1"><Icon name="trash-2" className="w-4 h-4"/> Remove</button>
                     </div>
                  </div>

                  {/* Image Row (Centered Underneath) */}
                  {combatant.image && (
                     <div className="w-full flex justify-center mt-4 border-t border-gray-700 pt-4">
                        <img 
                            src={combatant.image} 
                            alt={combatant.name} 
                            className="rounded-lg shadow-lg max-h-64 object-contain border-2 border-amber-500/50"
                            onError={(e) => { e.target.style.display='none'; }} 
                        />
                     </div>
                  )}

                </div>
              );
            })}
          </div>

          {/* Add Enemy Modal */}
          {showModal && (
            <div className="fixed inset-0 bg-black/80 flex items-center justify-center p-4 z-50">
               <div className={`${theme.bgSecondary} rounded-xl shadow-2xl max-w-md w-full p-6 border ${theme.border}`}>
                  <h3 className={`text-2xl font-bold ${theme.text} mb-4`}>Summon Enemy</h3>
                  
                  <div className="space-y-4 mb-6">
                     <div>
                        <label className={`block text-sm font-bold ${theme.textMuted} mb-1`}>Category</label>
                        <select className={`w-full p-3 rounded bg-gray-700 text-white border border-gray-600`} value={selectedCat} onChange={handleCatChange}>
                           {Object.keys(BESTIARY_DATA).map(k => <option key={k} value={k}>{BESTIARY_DATA[k].title}</option>)}
                        </select>
                     </div>
                     <div>
                        <label className={`block text-sm font-bold ${theme.textMuted} mb-1`}>Creature</label>
                        <select className={`w-full p-3 rounded bg-gray-700 text-white border border-gray-600`} value={selectedIdx} onChange={(e) => setSelectedIdx(parseInt(e.target.value))}>
                           {BESTIARY_DATA[selectedCat].creatures.map((c, i) => <option key={i} value={i}>{c.name} (HP: {c.hp})</option>)}
                        </select>
                     </div>
                  </div>

                  <div className="flex gap-3">
                     <button onClick={handleAddEnemy} className="flex-1 bg-red-600 text-white py-3 rounded font-bold hover:bg-red-700">Add to Combat</button>
                     <button onClick={() => setShowModal(false)} className="flex-1 bg-gray-600 text-white py-3 rounded font-bold hover:bg-gray-700">Cancel</button>
                  </div>
               </div>
            </div>
          )}
        </div>
      );
    };

// ============================================
    // DICE TAB (Traditional Feel: Slower + Clacking Sounds)
    // ============================================
    const DiceTab = ({ theme }) => {
      const [rolls, setRolls] = useState([]);
      const [modifier, setModifier] = useState(0);
      const [lastResult, setLastResult] = useState(null);
      const [displayValue, setDisplayValue] = useState('?'); // For the animation
      const [isRolling, setIsRolling] = useState(false);
      const [diceSkin, setDiceSkin] = useState('standard');

      // Updated skins to be slightly more earthy/matte by default
      const skins = {
        standard: { name: 'Standard Amber', text: 'text-amber-600', border: 'border-amber-600', glow: 'shadow-none' }, // Removed glow for realism
        blood: { name: 'Blood of Giants', text: 'text-red-800', border: 'border-red-800', glow: 'shadow-none' },
        bone: { name: 'Ancient Bone', text: 'text-stone-500', border: 'border-stone-500', glow: 'shadow-none' },
        sapphire: { name: 'Watcher Sapphire', text: 'text-blue-700', border: 'border-blue-700', glow: 'shadow-none' },
        void: { name: 'Void Purple', text: 'text-purple-800', border: 'border-purple-800', glow: 'shadow-none' },
        emerald: { name: 'Serpent Green', text: 'text-emerald-700', border: 'border-emerald-700', glow: 'shadow-none' }
      };

      // NEW SOUND ENGINE: Synthesizes "Clacks" instead of "Beeps"
      const playDiceSound = (type) => {
        try {
          const AudioContext = window.AudioContext || window.webkitAudioContext;
          if (!AudioContext) return;
          const ctx = new AudioContext();
          
          // Helper to create a noise burst (impact sound)
          const createImpact = (time, duration, frequency) => {
            const bufferSize = ctx.sampleRate * duration;
            const buffer = ctx.createBuffer(1, bufferSize, ctx.sampleRate);
            const data = buffer.getChannelData(0);
            
            // Fill with white noise
            for (let i = 0; i < bufferSize; i++) {
              data[i] = Math.random() * 2 - 1;
            }

            const noise = ctx.createBufferSource();
            noise.buffer = buffer;

            // Filter the noise to sound more like plastic/bone (Bandpass)
            const filter = ctx.createBiquadFilter();
            filter.type = 'bandpass';
            filter.frequency.value = frequency; // 1000-3000Hz gives a good "clack"
            filter.Q.value = 1;

            // Envelope for the "hit"
            const gain = ctx.createGain();
            gain.gain.setValueAtTime(0.5, time);
            gain.gain.exponentialRampToValueAtTime(0.01, time + duration);

            noise.connect(filter);
            filter.connect(gain);
            gain.connect(ctx.destination);
            
            noise.start(time);
          };

          const now = ctx.currentTime;

          if (type === 'shake') {
            // Play a rattle (multiple small impacts)
            for(let i = 0; i < 5; i++) {
               createImpact(now + (i * 0.08), 0.05, 2000 + Math.random() * 1000);
            }
          } else if (type === 'land') {
            // One final heavier thud
            createImpact(now, 0.1, 800);
          }

        } catch (e) { console.error("Audio fail", e); }
      };

      const rollDice = (sides, count = 1) => {
        if (isRolling) return;
        setIsRolling(true);
        setLastResult(null);
        
        // 1. Start the "Shake" sound
        playDiceSound('shake');

        // 2. Determine final results immediately (but don't show yet)
        const results = [];
        for (let i = 0; i < count; i++) { results.push(Math.floor(Math.random() * sides) + 1); }
        const total = results.reduce((a, b) => a + b, 0) + modifier;
        const newRoll = { dice: `${count}d${sides}${modifier !== 0 ? ` ${modifier > 0 ? '+' : ''}${modifier}` : ''}`, results, modifier, total, timestamp: new Date().toLocaleTimeString(), skin: diceSkin };

        // 3. Animation Logic: Decelerating Ticker
        let speed = 50; // Start fast (50ms)
        const maxTime = 1800; // Duration in ms
        let elapsed = 0;

        const animate = () => {
          // Show a random number while rolling
          setDisplayValue(Math.floor(Math.random() * (sides * count)) + 1 + modifier);
          
          elapsed += speed;
          speed += 15; // Slow down (increase interval) each step

          if (elapsed < maxTime) {
            setTimeout(animate, speed);
          } else {
            // 4. Finish
            playDiceSound('land'); // Final clack
            setLastResult(total);
            setDisplayValue(total);
            setRolls(prev => [newRoll, ...prev].slice(0, 20));
            setIsRolling(false);
          }
        };

        animate();
      };

      const currentSkin = skins[diceSkin];

      return (
        <div className="max-w-4xl mx-auto">
          {/* Controls */}
          <div className="flex justify-end mb-4">
             <div className={`${theme.bgSecondary} px-3 py-2 rounded-lg border ${theme.border} flex items-center gap-2 shadow-sm`}>
                <span className={`text-sm font-bold ${theme.textMuted}`}>Dice Material:</span>
                <select 
                  value={diceSkin}
                  onChange={(e) => setDiceSkin(e.target.value)}
                  className={`bg-transparent ${currentSkin.text} font-bold focus:outline-none cursor-pointer uppercase tracking-wider text-sm appearance-none pr-4`}
                >
                  {Object.entries(skins).map(([key, skin]) => (
                    <option key={key} value={key} className="bg-gray-800 text-white">{skin.name}</option>
                  ))}
                </select>
                <Icon name="chevron-down" className={`w-4 h-4 ${currentSkin.text}`} />
             </div>
          </div>

          {/* The Rolling Area */}
          <div className={`${theme.card} rounded-xl shadow-xl p-6 mb-6`}>
            <div className="text-center mb-10 relative h-32 flex items-center justify-center">
                {/* Visual Change: Removed the blur/glow animation for a solid, heavy look */}
                <div className={`text-9xl font-extrabold transition-all duration-100 relative select-none ${currentSkin.text} ${isRolling ? 'opacity-80' : 'scale-110'}`}>
                    {isRolling ? displayValue : (lastResult !== null ? lastResult : '?')}
                </div>
                <p className={`${theme.textMuted} absolute -bottom-4 w-full text-center font-mono text-sm`}>
                    {isRolling ? 'Rolling...' : (rolls[0] ? `Result of ${rolls[0].dice}` : 'Ready to Roll')}
                </p>
            </div>

            {/* Modifier Controls */}
            <div className="mb-8 max-w-xs mx-auto">
              <label className={`block ${theme.text} text-center font-bold mb-2 text-xs uppercase tracking-widest opacity-70`}>Modifier</label>
              <div className="flex items-center gap-2">
                <button onClick={() => setModifier(modifier - 1)} className={`w-12 h-12 ${theme.bgTertiary} ${theme.text} border ${theme.border} rounded-lg font-bold text-xl`}>-</button>
                <input type="number" value={modifier} onChange={(e) => setModifier(parseInt(e.target.value) || 0)} className={`flex-1 text-center text-3xl font-bold bg-transparent border-b-2 ${theme.border} ${theme.text} p-2 focus:outline-none`} disabled={isRolling} />
                <button onClick={() => setModifier(modifier + 1)} className={`w-12 h-12 ${theme.bgTertiary} ${theme.text} border ${theme.border} rounded-lg font-bold text-xl`}>+</button>
              </div>
            </div>

            {/* Dice Buttons */}
            <div className="grid grid-cols-4 gap-3 mb-6">
              {[4, 6, 8, 10, 12, 20].map(sides => (
                <button key={sides} onClick={() => rollDice(sides)} disabled={isRolling} className={`${theme.bgSecondary} border ${theme.border} py-4 rounded-xl shadow-lg hover:translate-y-[-2px] transition-all disabled:opacity-50 disabled:hover:translate-y-0 group`}>
                  <span className={`${theme.textMuted} text-lg`}>d</span>
                  <span className={`${currentSkin.text} text-2xl font-bold`}>{sides}</span>
                </button>
              ))}
              <div className="col-span-2">
                <button onClick={() => rollDice(20, 2)} disabled={isRolling} className={`w-full h-full ${theme.bgSecondary} border ${theme.border} rounded-xl shadow-lg hover:translate-y-[-2px] transition-all flex items-center justify-center gap-2`}>
                    <span className={`${currentSkin.text} text-xl font-bold`}>2d20</span>
                    <span className={theme.textMuted}>(Advantage)</span>
                </button>
              </div>
            </div>
            <button onClick={() => setRolls([])} className={`w-full text-xs uppercase tracking-widest ${theme.textMuted} hover:${theme.text} transition-colors mt-4`}>Clear History</button>
          </div>

          {/* Roll History */}
          <div className={`${theme.card} rounded-xl shadow-xl p-6`}>
            <h3 className={`text-xl font-bold ${theme.text} mb-4`}>Roll History</h3>
            <div className="space-y-2 max-h-60 overflow-y-auto pr-2 custom-scrollbar">
              {rolls.map((roll, idx) => {
                const rollSkin = skins[roll.skin] || skins.standard;
                return (
                    <div key={idx} className={`${theme.bgTertiary} rounded-lg p-3 border-l-4 ${rollSkin.border} flex justify-between items-center`}>
                      <div><span className={`font-bold ${theme.text} mr-2`}>{roll.dice}</span><span className={`${theme.textSecondary} text-sm`}>[{roll.results.join(', ')}]</span></div>
                      <div className="flex items-center gap-3"><span className={`text-xl font-bold ${rollSkin.text}`}>{roll.total}</span><span className={`text-xs ${theme.textMuted}`}>{roll.timestamp}</span></div>
                    </div>
                );
              })}
              {rolls.length === 0 && <div className={`text-center ${theme.textMuted} py-8`}>No rolls yet</div>}
            </div>
          </div>
        </div>
      );
    };

    // ============================================
    // REFERENCE TAB (Updated to use GLOBAL DATA)
    // ============================================
    const ReferenceTab = ({ theme }) => {
      const [selectedSection, setSelectedSection] = useState('miracles');
      const sections = [
        { id: 'miracles', name: 'Miracles', icon: 'flame' },
        { id: 'monsters', name: 'Bestiary', icon: 'shield' },
        { id: 'righteousness', name: 'Righteousness', icon: 'heart' },
        { id: 'combat', name: 'Combat', icon: 'sword' }
      ];

      return (
        <div className="max-w-6xl mx-auto">
          <div className="flex flex-col md:flex-row gap-6">
            <div className="md:w-64">
              <div className={`${theme.card} rounded-xl shadow-xl p-4 space-y-2`}>
                {sections.map(section => (
                  <button key={section.id} onClick={() => setSelectedSection(section.id)} className={`w-full flex items-center gap-3 p-3 rounded-lg transition-all ${selectedSection === section.id ? `${theme.accent} text-white shadow-lg` : `${theme.bgTertiary} ${theme.text} hover:bg-opacity-80`}`}>
                    <Icon name={section.icon} /><span className="font-bold">{section.name}</span>
                  </button>
                ))}
              </div>
            </div>
            <div className={`flex-1 ${theme.card} rounded-xl shadow-xl p-6`}>
              {selectedSection === 'miracles' && <MiraclesRef theme={theme} />}
              {selectedSection === 'monsters' && <MonstersRef theme={theme} />}
              {selectedSection === 'righteousness' && <RighteousnessRef theme={theme} />}
              {selectedSection === 'combat' && <CombatRef theme={theme} />}
            </div>
          </div>
        </div>
      );
    };

    const MiraclesRef = ({ theme }) => (
      <div>
        <h2 className={`text-2xl font-bold ${theme.text} mb-4`}>Miracles & Divine Powers</h2>
        <div className="space-y-4">
          <MiracleCard theme={theme} name="Divine Guidance" cost={1} desc="Gain advantage on your next check" />
          <MiracleCard theme={theme} name="Healing Touch" cost={1} desc="Restore 1d8 + FAI modifier HP" />
          <MiracleCard theme={theme} name="Smite the Wicked" cost={2} desc="Next attack deals +2d8 radiant damage" />
          <MiracleCard theme={theme} name="Call Down Fire" cost={3} desc="15-foot area, 4d10 damage (DEX save half)" />
          <MiracleCard theme={theme} name="Hymn of Protection" cost={1} desc="Allies within earshot gain +2 Defense for 1 minute" />
        </div>
      </div>
    );
    const MiracleCard = ({ theme, name, cost, desc }) => (
      <div className={`${theme.bgTertiary} rounded-lg p-4 border-l-4 border-amber-500`}>
        <div className="flex justify-between items-start mb-2"><h3 className={`text-lg font-bold ${theme.text}`}>{name}</h3><span className="bg-blue-500 text-white px-3 py-1 rounded-full text-sm font-bold">{cost} CP</span></div>
        <p className={theme.textSecondary}>{desc}</p>
      </div>
    );

const MonstersRef = ({ theme }) => {
      const [category, setCategory] = useState('giants');
      const [selectedImage, setSelectedImage] = useState(null);
      const categories = [
        { id: 'giants', name: 'Giants', icon: 'skull' },
        { id: 'watchers', name: 'Watchers', icon: 'eye' },
        { id: 'corrupted', name: 'Corrupted', icon: 'users' },
        { id: 'spirits', name: 'Spirits', icon: 'flame' },
        { id: 'beasts', name: 'Beasts', icon: 'shield' }
      ];

      const currentCategory = BESTIARY_DATA[category];

      return (
        <div>
          {selectedImage && (
            <div className="fixed inset-0 bg-black/80 z-50 flex items-center justify-center p-4 cursor-pointer" onClick={() => setSelectedImage(null)}>
              <div className="relative max-w-4xl max-h-[90vh]">
                <img src={selectedImage} alt="Creature" className="max-w-full max-h-[90vh] object-contain rounded-lg shadow-2xl" onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/600x400/333/orange?text=Image+Missing`; }} />
                <button onClick={() => setSelectedImage(null)} className="absolute top-2 right-2 bg-black/50 text-white p-2 rounded-full hover:bg-black/70"><Icon name="x" className="w-6 h-6" /></button>
              </div>
            </div>
          )}
          <h2 className={`text-2xl font-bold ${theme.text} mb-4`}>Bestiary</h2>
          <div className="flex flex-wrap gap-2 mb-6">
            {categories.map(cat => (
              <button key={cat.id} onClick={() => setCategory(cat.id)} className={`flex items-center gap-2 px-4 py-2 rounded-lg transition-all ${category === cat.id ? 'bg-amber-600 text-white' : `${theme.bgTertiary} ${theme.text} hover:bg-amber-700 hover:text-white`}`}>
                <Icon name={cat.icon} className="w-4 h-4" /><span>{cat.name}</span>
              </button>
            ))}
          </div>
          <div className={`${theme.card} rounded-xl p-6 mb-6`}>
            <h3 className={`text-xl font-bold ${theme.text} mb-2`}>{currentCategory.title}</h3>
            <p className={`${theme.textSecondary} italic`}>{currentCategory.intro}</p>
          </div>
          <div className="space-y-4">
            {currentCategory.creatures.map((creature, idx) => (
              <div key={idx} className={`${theme.card} rounded-xl overflow-hidden ${creature.legendary ? 'ring-2 ring-amber-500' : ''}`}>
                <div className="flex flex-col md:flex-row">
                  {creature.image && (
                    <div className="md:w-48 h-48 md:h-auto flex-shrink-0 cursor-pointer group relative overflow-hidden bg-black" onClick={() => setSelectedImage(creature.image)}>
                      <img src={creature.image} alt={creature.name} className="w-full h-full object-cover transition-transform duration-300 group-hover:scale-110" onError={(e) => { e.target.onerror = null; e.target.src = `https://placehold.co/400x400/222/d97706?text=${creature.name.replace(/ /g, '+')}`; }} />
                      <div className="absolute inset-0 bg-black/0 group-hover:bg-black/30 transition-colors flex items-center justify-center"><Icon name="zoom-in" className="w-8 h-8 text-white opacity-0 group-hover:opacity-100 transition-opacity" /></div>
                    </div>
                  )}
                  <div className="flex-1 p-4">
                    <div className="flex justify-between items-start mb-2"><h4 className={`text-lg font-bold ${theme.text}`}>{creature.name}{creature.legendary && <span className="ml-2 text-amber-400 text-sm">‚òÖ LEGENDARY</span>}</h4></div>
                    <div className="flex flex-wrap gap-3 mb-3 text-sm">
                      <span className={`${theme.bgTertiary} px-2 py-1 rounded`}><strong>HD:</strong> {creature.hd}</span>
                      <span className={`${theme.bgTertiary} px-2 py-1 rounded`}><strong>HP:</strong> {creature.hp}</span>
                      <span className={`${theme.bgTertiary} px-2 py-1 rounded`}><strong>DEF:</strong> {creature.def}</span>
                    </div>
                    <p className={`${theme.textSecondary} text-sm mb-2`}><strong className={theme.text}>Attack:</strong> {creature.attack}</p>
                    <p className={`${theme.textSecondary} text-sm mb-2`}><strong className={theme.text}>Special:</strong> {creature.special}</p>
                    <p className={`${theme.textMuted} text-sm italic mb-3`}>{creature.desc}</p>
                    
                    {/* NEW LORE SECTION */}
                    {creature.lore && (
                        <div className={`mt-3 p-3 rounded text-sm leading-relaxed border ${theme.border} bg-opacity-50 ${theme.bgTertiary}`}>
                            <div className="flex items-center gap-2 mb-1 opacity-75">
                                <Icon name="book-open" className="w-3 h-3" />
                                <span className="text-xs font-bold uppercase tracking-widest">Ancient Lore</span>
                            </div>
                            <p className={theme.textSecondary}>{creature.lore}</p>
                        </div>
                    )}

                  </div>
                </div>
              </div>
            ))}
          </div>
        </div>
      );
    };

    const RighteousnessRef = ({ theme }) => (
      <div>
        <h2 className={`text-2xl font-bold ${theme.text} mb-4`}>Righteousness Track</h2>
        <div className="space-y-3">
          <RLevel theme={theme} range="+8 to +10" label="Anointed" desc="Divine favor, miracles cost less" color="blue" />
          <RLevel theme={theme} range="+4 to +7" label="Righteous" desc="Clear conscience, divine protection" color="blue" />
          <RLevel theme={theme} range="+1 to +3" label="Faithful" desc="Minor blessings" color="blue" />
          <RLevel theme={theme} range="0" label="Wavering" desc="Neutral" color="gray" />
          <RLevel theme={theme} range="-1 to -3" label="Compromised" desc="Guilt, nightmares" color="yellow" />
          <RLevel theme={theme} range="-4 to -7" label="Corrupted" desc="Forbidden knowledge accessible" color="orange" />
          <RLevel theme={theme} range="-8 to -10" label="Abomination" desc="Marked for judgment" color="red" />
        </div>
      </div>
    );
    const RLevel = ({ theme, range, label, desc, color }) => {
      const colors = { blue: 'border-blue-500', gray: 'border-gray-500', yellow: 'border-yellow-500', orange: 'border-orange-500', red: 'border-red-500' };
      return (
        <div className={`${theme.bgTertiary} rounded-lg p-4 border-l-4 ${colors[color]}`}>
          <div className="flex justify-between mb-1"><h3 className={`font-bold ${theme.text}`}>{label}</h3><span className={`text-sm ${theme.textMuted}`}>{range}</span></div>
          <p className={`text-sm ${theme.textSecondary}`}>{desc}</p>
        </div>
      );
    };

    const CombatRef = ({ theme }) => (
      <div>
        <h2 className={`text-2xl font-bold ${theme.text} mb-4`}>Combat Rules</h2>
        <div className="space-y-6">
          <div>
            <h3 className={`text-xl font-bold ${theme.text} mb-2`}>Making Attacks</h3>
            <div className={`${theme.bgTertiary} rounded-lg p-4 border ${theme.border}`}>
              <p className={theme.textSecondary}><strong>Melee:</strong> 1d20 + STR + Melee vs Defense</p>
              <p className={theme.textSecondary}><strong>Ranged:</strong> 1d20 + DEX + Ranged vs Defense</p>
            </div>
          </div>
          <div>
            <h3 className={`text-xl font-bold ${theme.text} mb-2`}>Weapon Damage</h3>
            <div className="grid md:grid-cols-2 gap-3">
              <div className={`${theme.bgTertiary} p-3 rounded border ${theme.border}`}><strong>Light:</strong> 1d6</div>
              <div className={`${theme.bgTertiary} p-3 rounded border ${theme.border}`}><strong>Medium:</strong> 1d8</div>
              <div className={`${theme.bgTertiary} p-3 rounded border ${theme.border}`}><strong>Heavy:</strong> 1d10</div>
              <div className={`${theme.bgTertiary} p-3 rounded border ${theme.border}`}><strong>Unarmed:</strong> 1d4</div>
            </div>
          </div>
        </div>
      </div>
    );
    // ============================================
    // IT IS WRITTEN TAB (Lore Compendium)
    // ============================================
    const ItIsWrittenTab = ({ theme, darkMode }) => {
      const [expandedSection, setExpandedSection] = useState('intro');

      const LoreSection = ({ id, title, icon, children }) => (
        <div className={`${theme.card} rounded-xl overflow-hidden mb-4`}>
          <button
            onClick={() => setExpandedSection(expandedSection === id ? null : id)}
            className={`w-full p-4 flex items-center justify-between transition-colors ${
              expandedSection === id ? `${darkMode ? 'bg-amber-900/30' : 'bg-amber-200'}` : ''
            }`}
          >
            <div className="flex items-center gap-3">
              <span className={theme.accentText}><Icon name={icon} /></span>
              <h3 className={`text-lg font-bold ${theme.text}`}>{title}</h3>
            </div>
            <Icon name={expandedSection === id ? "chevron-up" : "chevron-down"} className={`w-5 h-5 ${theme.textMuted}`} />
          </button>
          
          {expandedSection === id && (
            <div className={`p-6 ${theme.bgSecondary} border-t ${theme.border}`}>
              {children}
            </div>
          )}
        </div>
      );

      const DataTable = ({ headers, rows }) => (
        <div className="overflow-x-auto">
          <table className="w-full text-sm">
            <thead>
              <tr className={theme.bgTertiary}>
                {headers.map((h, i) => (
                  <th key={i} className={`p-3 text-left font-bold ${theme.text} border ${theme.border}`}>{h}</th>
                ))}
              </tr>
            </thead>
            <tbody>
              {rows.map((row, i) => (
                <tr key={i} className={i % 2 === 0 ? theme.bgSecondary : theme.bgTertiary}>
                  {row.map((cell, j) => (
                    <td key={j} className={`p-3 ${theme.textSecondary} border ${theme.border}`}>{cell}</td>
                  ))}
                </tr>
              ))}
            </tbody>
          </table>
        </div>
      );

      return (
        <div className="max-w-5xl mx-auto">
          {/* Header */}
          <div className={`${theme.card} rounded-xl overflow-hidden mb-6`}>
            <div className={`relative p-8 ${darkMode ? 'bg-gradient-to-br from-gray-800 via-gray-900 to-black' : 'bg-gradient-to-br from-amber-800 via-amber-900 to-amber-950'} text-white`}>
              <div className="relative z-10">
                <div className="flex items-center gap-3 mb-2">
                  <Icon name="book-marked" className="w-6 h-6 text-amber-400" />
                  <span className="text-amber-400 text-sm font-semibold tracking-widest uppercase">Sacred Lore Compendium</span>
                </div>
                <h2 className="text-4xl md:text-5xl font-bold mb-3 tracking-tight">It Is Written</h2>
                <p className="text-amber-200/80 text-lg italic max-w-2xl">
                  "And Enoch walked with God: and he was not; for God took him."
                </p>
                <p className="text-amber-300/60 text-sm mt-2">‚Äî Genesis 5:24</p>
              </div>
            </div>
            
            <div className={`p-4 ${theme.bgTertiary} border-t ${theme.border}`}>
              <p className={`${theme.textSecondary} text-sm`}>
                This compendium draws from Genesis, 1 Enoch (Book of the Watchers), the Book of Giants (Dead Sea Scrolls), 
                and Jubilees to provide historically grounded source material for your campaigns.
              </p>
            </div>
          </div>

          {/* Sections */}
          <LoreSection id="intro" title="The Pre-Flood World" icon="globe">
            <div className={`${theme.textSecondary} space-y-4 leading-relaxed`}>
              <p>
                The pre-Flood world presents a setting with <strong className={theme.text}>two diverging human lineages</strong>‚ÄîCain's 
                technologically advanced but godless civilization versus Seth's faithful remnant‚Äî<strong className={theme.text}>200 rebel angels</strong> who each taught specific 
                forbidden arts, and <strong className={theme.text}>three generations of giant offspring</strong> whose spirits became the demons plaguing humanity.
              </p>
              <p>
                In the days of Jared, two hundred angels called <strong className={theme.text}>Watchers</strong> descended upon <strong className={theme.text}>Mount Hermon</strong>‚Äîthe 
                9,232-foot peak at the border of modern Syria, Lebanon, and Israel. The mountain's name derives from the Hebrew root meaning "curse" or "devoted to destruction."
              </p>
            </div>
          </LoreSection>

          <LoreSection id="cain" title="The Line of Cain" icon="crown">
            <div className={`${theme.textSecondary} space-y-4 leading-relaxed`}>
              <p>
                Cain's descendants created the first urban civilization, developing <strong className={theme.text}>animal husbandry, music, and metallurgy</strong>‚Äîbut 
                within a moral framework of escalating violence.
              </p>
              <p className={`${theme.bgTertiary} p-3 rounded-lg font-mono text-center`}>
                Adam ‚Üí Cain ‚Üí Enoch ‚Üí Irad ‚Üí Mehujael ‚Üí Methusael ‚Üí Lamech
              </p>
              
              <h4 className={`text-lg font-bold ${theme.text} mt-6 mb-3`}>The Cainite Innovators</h4>
              <DataTable 
                headers={['Name', 'Innovation', 'RPG Archetype']}
                rows={[
                  ['Jabal', 'Nomadic herding', 'Ranger/Shepherd'],
                  ['Jubal', 'Music (kinnor and ugab)', 'Bard/Musician'],
                  ['Tubal-cain', 'Bronze and iron forging', 'Artificer/Smith'],
                  ['Naamah', 'Mystery figure', 'Unknown'],
                ]}
              />
            </div>
          </LoreSection>

          <LoreSection id="seth" title="The Line of Seth" icon="heart">
            <div className={`${theme.textSecondary} space-y-4 leading-relaxed`}>
              <p>The Sethite genealogy spans ten generations with extraordinary lifespans:</p>
              <DataTable 
                headers={['Gen', 'Name', 'Lifespan', 'Feature']}
                rows={[
                  ['2', 'Seth', '912 yrs', 'Began the godly line'],
                  ['7', 'Enoch', '365 yrs', 'Walked with God; taken'],
                  ['8', 'Methuselah', '969 yrs', 'Longest-lived human'],
                  ['10', 'Noah', '950 yrs', 'Survived the Flood'],
                ]}
              />
            </div>
          </LoreSection>

          <LoreSection id="watchers" title="The 200 Watchers" icon="eye">
            <div className={`${theme.textSecondary} space-y-4 leading-relaxed`}>
              <p>Led by <strong className={theme.text}>Semyaza</strong>, the Watchers bound themselves by mutual oath on Mount Hermon.</p>
              
              <h4 className={`text-lg font-bold ${theme.text} mt-6 mb-3`}>Chiefs and Their Teachings</h4>
              <DataTable 
                headers={['Watcher', 'Forbidden Teaching']}
                rows={[
                  ['Semyaza', 'Enchantments, root-cutting'],
                  ['Azazel', 'Weapons, metallurgy, cosmetics'],
                  ['Armaros', 'Counter-magic'],
                  ['Baraqijal', 'Astrology'],
                  ['Kokabel', 'Constellations'],
                  ['Gadreel', 'Deceived Eve, deadly weapons'],
                ]}
              />
            </div>
          </LoreSection>

          <LoreSection id="giants" title="Three Generations of Giants" icon="skull">
            <div className={`${theme.textSecondary} space-y-4 leading-relaxed`}>
              <blockquote className={`${theme.bgTertiary} p-4 rounded-lg border-l-4 border-amber-500 italic`}>
                "And they bore three races‚Äîfirst, the great giants. The giants brought forth the Naphelim, 
                and the Naphelim brought forth the Elioud."
              </blockquote>
              
              <DataTable 
                headers={['Generation', 'Name', 'Parentage', 'Size']}
                rows={[
                  ['1st', 'Giants', 'Watcher + Human', '30-50 ft'],
                  ['2nd', 'Nephilim', 'Giant + Human', '15-30 ft'],
                  ['3rd', 'Elioud', 'Nephilim + Human', '10-20 ft'],
                ]}
              />
              
              <h4 className={`text-lg font-bold ${theme.text} mt-6 mb-3`}>Named Giants (Book of Giants)</h4>
              <div className="space-y-2">
                <div className={`${theme.bgTertiary} p-3 rounded-lg border-l-4 border-red-500`}>
                  <strong className={theme.text}>Ohya</strong> ‚Äî Son of Semyaza, wrathful leader with prophetic dreams
                </div>
                <div className={`${theme.bgTertiary} p-3 rounded-lg border-l-4 border-red-500`}>
                  <strong className={theme.text}>Mahway</strong> ‚Äî Son of Barakel, possesses flight capability
                </div>
                <div className={`${theme.bgTertiary} p-3 rounded-lg border-l-4 border-red-500`}>
                  <strong className={theme.text}>Gilgamesh</strong> ‚Äî The legendary hero appears as one of the giants
                </div>
              </div>
            </div>
          </LoreSection>

          <LoreSection id="instruments" title="Ancient Instruments" icon="music">
            <div className={`${theme.textSecondary} space-y-4 leading-relaxed`}>
              <p>Jubal was "father of all who play the <strong className={theme.text}>kinnor</strong> and <strong className={theme.text}>ugab</strong>."</p>
              
              <DataTable 
                headers={['Hebrew', 'English', 'Supernatural Function']}
                rows={[
                  ['Kinnor', 'Lyre', 'Drives away evil spirits'],
                  ['Nevel', 'Harp', 'Worship, prophecy'],
                  ['Shofar', 'Ram\'s horn', 'Spiritual warfare'],
                  ['Toph', 'Tambourine', 'Celebration, victory'],
                ]}
              />
              
              <h4 className={`text-lg font-bold ${theme.text} mt-6 mb-3`}>Worshipping Servant Abilities</h4>
              <div className="space-y-2">
                <div className={`${theme.bgTertiary} p-3 rounded-lg border-l-4 border-amber-500`}>
                  <strong className={theme.text}>Spirit Driving</strong> ‚Äî Dispel evil spirits through skilled performance
                </div>
                <div className={`${theme.bgTertiary} p-3 rounded-lg border-l-4 border-amber-500`}>
                  <strong className={theme.text}>Prophetic Enhancement</strong> ‚Äî Open channels for divine revelation
                </div>
                <div className={`${theme.bgTertiary} p-3 rounded-lg border-l-4 border-amber-500`}>
                  <strong className={theme.text}>Divine Presence</strong> ‚Äî Summon divine blessing through unified worship
                </div>
              </div>
            </div>
          </LoreSection>
        </div>
      );
    };

    // Render the app
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<NephilimWarsApp />);
  </script>
</body>
</html>